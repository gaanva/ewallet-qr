{"ast":null,"code":"import _asyncToGenerator from \"/Users/gabrielvaldez/Documents/Workspace/Ionic/eWallet/ewallet-qr/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./services/QR/device-code-flow.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"angular2-qrcode\";\nimport * as i5 from \"@angular/forms\";\nfunction AppComponent_tr_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"p\")(3, \"strong\");\n    i0.ɵɵtext(4, \"Step 2) ->\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \" Scan the QR Code with your phone camera or your ewallet app!.\");\n    i0.ɵɵelement(6, \"br\");\n    i0.ɵɵtext(7, \" and confirm the device. It is the USER CODE will see:\");\n    i0.ɵɵelementStart(8, \"strong\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(10, \"td\")(11, \"div\");\n    i0.ɵɵelement(12, \"qr-code\", 4)(13, \"br\");\n    i0.ɵɵelementStart(14, \"textarea\", 5);\n    i0.ɵɵlistener(\"ngModelChange\", function AppComponent_tr_12_Template_textarea_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.values = $event);\n    });\n    i0.ɵɵtext(15, \"            <!-- input [(ngModel)]=\\\"values\\\" placeholder=\\\"name\\\" / -->\\n          \");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate(ctx_r0.userCode);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"value\", ctx_r0.values)(\"size\", ctx_r0.width)(\"level\", ctx_r0.level);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.values);\n  }\n}\nfunction AppComponent_tr_13_td_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\")(1, \"textarea\", 6);\n    i0.ɵɵlistener(\"ngModelChange\", function AppComponent_tr_13_td_8_Template_textarea_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.token = $event);\n    });\n    i0.ɵɵtext(2, \"          <!-- input [(ngModel)]=\\\"values\\\" placeholder=\\\"name\\\" / -->\\n        \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r5.token);\n  }\n}\nfunction AppComponent_tr_13_td_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\")(1, \"p\", 7)(2, \"strong\");\n    i0.ɵɵtext(3, \"ERROR! Did the user finish the Step2 succesfully?\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction AppComponent_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"p\")(3, \"strong\");\n    i0.ɵɵtext(4, \"Step 3) -> \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"After finish the authorization proceess in your phone, obtain the token for the Totem.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_13_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.getToken());\n    });\n    i0.ɵɵtext(7, \"Get TOKEN from Totem\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(8, AppComponent_tr_13_td_8_Template, 3, 1, \"td\", 3);\n    i0.ɵɵtemplate(9, AppComponent_tr_13_td_9_Template, 4, 0, \"td\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.token && !ctx_r1.token.includes(\"Error\"));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.token && ctx_r1.token.includes(\"Error\"));\n  }\n}\nfunction AppComponent_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"p\")(3, \"strong\");\n    i0.ɵɵtext(4, \"Step 4) -> \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"Make the payment! The details should be presented previously.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 2);\n    i0.ɵɵlistener(\"click\", function AppComponent_tr_14_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.makePayment());\n    });\n    i0.ɵɵtext(7, \"Make the Payment\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"td\")(9, \"textarea\", 8);\n    i0.ɵɵlistener(\"ngModelChange\", function AppComponent_tr_14_Template_textarea_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.payment = $event);\n    });\n    i0.ɵɵtext(10, \"          <!-- input [(ngModel)]=\\\"values\\\" placeholder=\\\"name\\\" / -->\\n        \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.payment);\n  }\n}\nexport class AppComponent {\n  constructor(deviceCF) {\n    this.deviceCF = deviceCF;\n    this.values = null;\n    this.userCode = null;\n    this.deviceCode = null;\n    this.token = null;\n    this.level = \"L\";\n    this.values = \"QR Code URL.\";\n    this.width = 200;\n  }\n  qrLevel(val) {\n    this.level = val;\n  }\n  qrData(val) {\n    this.values = val;\n  }\n  qrWidth(val) {\n    this.width = val;\n  }\n  startdeviceFlow() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      console.log('starting DCF');\n      _this.deviceCF.getQRCodeURL().subscribe(response => {\n        console.log('finishing DCF');\n        console.log(JSON.stringify(response.r));\n        _this.userCode = response.r.user_code;\n        _this.deviceCode = response.r.device_code;\n        _this.values = response.r.verification_uri_complete;\n      }, response => {\n        console.log(\"POST call in error\", response);\n      }, () => {\n        console.log(\"The POST observable is now completed.\");\n      });\n    })();\n  }\n  getToken() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.deviceCF.obtainToken(_this2.deviceCode).subscribe(response => {\n        console.log('finishing REQUESTING tokens');\n        console.log(JSON.stringify(response));\n        _this2.token = JSON.stringify(response);\n        //this.values = response.r.verification_uri_complete;\n      }, err => {\n        console.log(\"get token error\", err);\n      }, () => {\n        console.log(\"The POST observable is now completed.\");\n      });\n    })();\n  }\n  //once the token is received, then trigger the payment agains the ewallet API.\n  makePayment() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      _this3.deviceCF.makeAPayment(_this3.token).subscribe(response => {\n        console.log('respuesta del payment endpoint: ' + JSON.stringify(response));\n        _this3.payment = JSON.stringify(response);\n      }, error => {\n        console.error(error);\n        alert(\"error making the payment \" + error);\n      });\n    })();\n  }\n}\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.DeviceCodeFlowService));\n};\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  decls: 16,\n  vars: 3,\n  consts: [[\"role\", \"main\", 1, \"content\"], [1, \"text-center\", \"align-middle\"], [3, \"click\"], [4, \"ngIf\"], [3, \"value\", \"size\", \"level\"], [\"input\", \"\", \"placeholder\", \"name\", 3, \"ngModel\", \"ngModelChange\"], [\"input\", \"\", \"placeholder\", \"Totem Access Token\", 3, \"ngModel\", \"ngModelChange\"], [2, \"color\", \"red\"], [\"input\", \"\", \"placeholder\", \"payment\", 3, \"ngModel\", \"ngModelChange\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n      i0.ɵɵtext(2, \"Device Authorization Flow (OAuth2)\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"table\", 1)(4, \"tr\")(5, \"td\")(6, \"p\")(7, \"strong\");\n      i0.ɵɵtext(8, \"Step 1) ->\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(9, \" Start the device Aiuthorization Flow.\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"button\", 2);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_10_listener() {\n        return ctx.startdeviceFlow();\n      });\n      i0.ɵɵtext(11, \"START\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(12, AppComponent_tr_12_Template, 16, 5, \"tr\", 3);\n      i0.ɵɵtemplate(13, AppComponent_tr_13_Template, 10, 2, \"tr\", 3);\n      i0.ɵɵtemplate(14, AppComponent_tr_14_Template, 11, 1, \"tr\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(15, \"router-outlet\");\n      i0.ɵɵelementEnd();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(12);\n      i0.ɵɵproperty(\"ngIf\", ctx.userCode);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.userCode);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.token && !ctx.token.includes(\"Error\"));\n    }\n  },\n  dependencies: [i2.NgIf, i3.RouterOutlet, i4.QRCodeComponent, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgModel]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}